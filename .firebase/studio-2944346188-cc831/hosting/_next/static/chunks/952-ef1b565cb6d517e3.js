"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[952],{21952:(e,t,r)=>{r.d(t,{DataProvider:()=>m,E:()=>h});var a=r(95155),i=r(12115),s=r(27936),o=r(41048),n=r(99470),u=r(15894),l=r(19708),c=r(47691),d=r(41962);let p=(0,i.createContext)(void 0);function m(e){let{children:t}=e,{user:r}=(0,s.useUser)(),m=(0,s.useFirestore)(),{toast:h}=(0,u.dj)(),f=null==r?void 0:r.uid,v=(0,s.useMemoFirebase)(()=>f?(0,l.P)((0,l.rJ)(m,"users",f,"banks")):null,[m,f]),{data:w,loading:E}=(0,o.G)(v),g=(0,s.useMemoFirebase)(()=>f?(0,l.P)((0,l.rJ)(m,"users",f,"categories")):null,[m,f]),{data:D,loading:S}=(0,o.G)(g),b=(0,s.useMemoFirebase)(()=>f?(0,l.P)((0,l.rJ)(m,"users",f,"paymentMethods")):null,[m,f]),{data:P,loading:F}=(0,o.G)(b),y=(0,s.useMemoFirebase)(()=>f?(0,l.P)((0,l.rJ)(m,"users",f,"expenses")):null,[m,f]),{data:I,loading:k}=(0,o.G)(y),x=(0,s.useMemoFirebase)(()=>f?(0,l.H9)(m,"users",f,"settings","salary"):null,[f,m]),{data:M,loading:N}=(0,n.u)(x),R=(0,s.useMemoFirebase)(()=>f?(0,l.H9)(m,"users",f,"profile","main"):null,[m,f]),{data:q,loading:C}=(0,n.u)(R),_=(0,i.useMemo)(()=>w?[...w].sort((e,t)=>e.name.localeCompare(t.name)):[],[w]),H=(0,i.useMemo)(()=>D?[...D].sort((e,t)=>e.name.localeCompare(t.name)):[],[D]),J=(0,i.useMemo)(()=>P?[...P].sort((e,t)=>e.name.localeCompare(t.name)):[],[P]),z=(0,i.useMemo)(()=>(null==M?void 0:M.amount)||0,[M]),G=(0,i.useMemo)(()=>I?I.map(e=>{let t,r=e.date;return t=r instanceof l.Dc?r.toDate().toISOString().split("T")[0]:"string"==typeof r?r:r&&r.toDate?r.toDate().toISOString().split("T")[0]:new Date().toISOString().split("T")[0],{...e,date:t}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):[],[I]),O=E||S||F||k||N||C,B=(e,t)=>{let r=f?(0,l.rJ)(m,"users",f,e):null;return{addItem:e=>{if(!r)return;let a={...e,createdAt:l.Dc.now()};(0,l.gS)(r,a).then(()=>{h({title:"Sucesso!",description:"".concat(t," adicionado(a).")})}).catch(e=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:r.path,operation:"create",requestResourceData:a})),h({title:"Erro!",description:"N\xe3o foi poss\xedvel adicionar ".concat(t.toLowerCase(),"."),variant:"destructive"})})},updateItem:r=>{if(!f)return;let{id:a,...i}=r,o=(0,l.H9)(m,"users",f,e,a);(0,l.mZ)(o,i).then(()=>{h({title:"Sucesso!",description:"".concat(t," atualizado(a).")})}).catch(e=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:o.path,operation:"update",requestResourceData:i})),h({title:"Erro!",description:"N\xe3o foi poss\xedvel atualizar ".concat(t.toLowerCase(),"."),variant:"destructive"})})},deleteItem:r=>{if(!f)return;let a=(0,l.H9)(m,"users",f,e,r);(0,l.kd)(a).then(()=>{h({title:"Sucesso!",description:"".concat(t," exclu\xeddo(a)."),variant:"destructive"})}).catch(e=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:a.path,operation:"delete"})),h({title:"Erro!",description:"N\xe3o foi poss\xedvel excluir ".concat(t.toLowerCase(),"."),variant:"destructive"})})}}},{addItem:$,updateItem:T,deleteItem:A}=B("banks","Banco"),{addItem:L,updateItem:U,deleteItem:j}=B("categories","Categoria"),{addItem:Z,updateItem:Q,deleteItem:K}=B("paymentMethods","Forma de Pagamento"),V=(e,t)=>{if(!m||!f)return;let{totalInstallments:r,amount:a,date:i,isRecurring:o,...n}=e,u=(0,l.rJ)(m,"users",f,"expenses"),p={...n};if(p.bank||delete p.bank,r>1){let n=(0,l.wP)(m),f=(0,l.H9)((0,l.rJ)(m,"tmp")).id,v=o?a:a/r,w=(0,c.o)(new Date(i));for(let t=0;t<r;t++){let a=(0,d.P)(w,t),i=(0,l.H9)(u),s={...p,amount:v,date:a.toISOString().split("T")[0],paid:0===t&&e.paid,isRecurring:o||!1,installments:{parentId:f,current:t+1,total:r}};n.set(i,s)}n.commit().then(()=>{o||h({title:"Sucesso!",description:"".concat(r," parcelas foram adicionadas.")}),null==t||t()}).catch(e=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:u.path,operation:"create",requestResourceData:{details:"Batch write for ".concat(r," installments.")}})),h({title:"Erro de Permiss\xe3o!",description:"N\xe3o foi poss\xedvel adicionar as despesas parceladas.",variant:"destructive"})})}else{let r={...p,amount:a,date:i,isRecurring:o||!1,paid:e.paid};(0,l.gS)(u,r).then(()=>{o||h({title:"Sucesso!",description:"Sua despesa foi adicionada."}),null==t||t()}).catch(e=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:u.path,operation:"create",requestResourceData:r})),h({title:"Erro!",description:"Ocorreu um erro ao adicionar a despesa.",variant:"destructive"})})}},W=async(e,t,r)=>{if(!m||!f)throw Error("Firestore ou usu\xe1rio n\xe3o dispon\xedvel.");let{id:a,...i}={...e};i.bank||(i.bank=(0,l.CL)());try{if(t&&i.installments){let e=(0,l.wP)(m),{parentId:t,current:r}=i.installments,s=(0,l.P)((0,l.rJ)(m,"users",f,"expenses"),(0,l._M)("installments.parentId","==",t));(await (0,l.GG)(s)).forEach(t=>{let s=t.data();if(s.installments&&s.installments.current>=r){let r=(0,l.H9)(m,"users",f,"expenses",t.id),{id:o,installments:n,paid:u,date:c,...d}=i;if(t.id===a)e.update(r,{...d,paid:u,date:c});else{let t={description:d.description,amount:d.isRecurring?d.amount:s.amount,category:d.category,paymentMethod:d.paymentMethod};d.bank?t.bank=d.bank:t.bank=(0,l.CL)(),e.update(r,t)}}}),await e.commit(),h({title:"Sucesso!",description:"Parcelas atualizadas."})}else{let{installments:e,...t}=i,r=(0,l.H9)(m,"users",f,"expenses",a);await (0,l.mZ)(r,t),h({title:"Sucesso!",description:"Despesa atualizada."})}null==r||r()}catch(r){let t="/users/".concat(f,"/expenses/").concat(e.id);throw s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:t,operation:"update",requestResourceData:i})),h({title:"Erro!",description:"Ocorreu um erro ao atualizar a despesa.",variant:"destructive"}),r}},X=async(e,t,r)=>{if(!m||!f)return;let a=G.find(t=>t.id===e);if(!a)return;let i=a.isRecurring;try{if(t&&(r||i)){var o,n;let t=(0,l.wP)(m),r=null==(o=a.installments)?void 0:o.parentId,i=(null==(n=a.installments)?void 0:n.current)||0;if(!r){let t=(0,l.H9)(m,"users",f,"expenses",e);await (0,l.kd)(t),h({title:"Sucesso!",description:"Despesa removida.",variant:"destructive"});return}let s=(0,l.P)((0,l.rJ)(m,"users",f,"expenses"),(0,l._M)("installments.parentId","==",r));(await (0,l.GG)(s)).forEach(e=>{let r=e.data();r.installments&&r.installments.current>=i&&t.delete(e.ref)}),await t.commit(),h({title:"Sucesso!",description:"Despesa e futuras ocorr\xeancias foram removidas.",variant:"destructive"})}else{let t=(0,l.H9)(m,"users",f,"expenses",e);await (0,l.kd)(t),i||h({title:"Sucesso!",description:"Despesa removida.",variant:"destructive"})}}catch(r){let t="/users/".concat(f,"/expenses/").concat(e);throw s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:t,operation:"delete"})),h({title:"Erro!",description:"Ocorreu um erro ao remover a despesa.",variant:"destructive"}),r}},Y=async(e,t)=>{if(!m||!f)return;let r=(0,l.wP)(m);e.forEach(e=>{let a=(0,l.H9)(m,"users",f,"expenses",e);r.update(a,{paid:t})});try{await r.commit(),h({title:"Sucesso!",description:"".concat(e.length," despesa(s) foram atualizadas.")})}catch(e){h({title:"Erro!",description:"Ocorreu um erro ao atualizar as despesas.",variant:"destructive"})}},ee=async e=>{if(!m||!f)return;let t=(0,l.wP)(m);e.forEach(e=>{let r=(0,l.H9)(m,"users",f,"expenses",e);t.delete(r)});try{await t.commit(),h({title:"Sucesso!",description:"".concat(e.length," despesa(s) foram removidas."),variant:"destructive"})}catch(e){h({title:"Erro!",description:"Ocorreu um erro ao remover as despesas.",variant:"destructive"})}},et=async e=>{if(!x)return;let t={amount:e};(0,l.BN)(x,t,{merge:!0}).catch(e=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:x.path,operation:"update",requestResourceData:t})),h({title:"Erro!",description:"N\xe3o foi poss\xedvel atualizar o sal\xe1rio.",variant:"destructive"})})},er=e=>{R&&(0,l.BN)(R,e,{merge:!0}).catch(t=>{s.errorEmitter.emit("permission-error",new s.FirestorePermissionError({path:R.path,operation:"update",requestResourceData:e})),h({title:"Erro!",description:"N\xe3o foi poss\xedvel atualizar o perfil.",variant:"destructive"})})},ea=(0,i.useMemo)(()=>({banks:_,categories:H,paymentMethods:J,expenses:G,salary:z,userProfile:q,loading:O,addBank:$,updateBank:T,deleteBank:A,addCategory:L,updateCategory:U,deleteCategory:j,addPaymentMethod:Z,updatePaymentMethod:Q,deletePaymentMethod:K,addExpense:V,updateExpense:W,deleteExpense:X,bulkUpdatePaidStatus:Y,bulkDeleteExpenses:ee,updateSalary:et,updateUserProfile:er}),[_,H,J,G,z,q,O]);return(0,a.jsx)(p.Provider,{value:ea,children:t})}function h(){let e=(0,i.useContext)(p);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}},27936:(e,t,r)=>{r.r(t),r.d(t,{FirebaseProvider:()=>a.R8,FirestorePermissionError:()=>u.$,addDocumentNonBlocking:()=>c,deleteDocumentNonBlocking:()=>p,errorEmitter:()=>n.d,initiateAnonymousSignIn:()=>h,initiateEmailSignIn:()=>v,initiateEmailSignUp:()=>f,setDocumentNonBlocking:()=>l,updateDocumentNonBlocking:()=>d,useAuth:()=>a.As,useCollection:()=>i.G,useDoc:()=>s.u,useFirebase:()=>a.D3,useFirebaseApp:()=>a.sh,useFirestore:()=>a.jt,useMemoFirebase:()=>a.$e,useUser:()=>a.Jd});var a=r(56091),i=r(41048),s=r(99470),o=r(19708),n=r(9891),u=r(86501);function l(e,t,r){(0,o.BN)(e,t,r).catch(r=>{n.d.emit("permission-error",new u.$({path:e.path,operation:"write",requestResourceData:t}))})}function c(e,t){return(0,o.gS)(e,t).catch(r=>{n.d.emit("permission-error",new u.$({path:e.path,operation:"create",requestResourceData:t}))})}function d(e,t){(0,o.mZ)(e,t).catch(r=>{n.d.emit("permission-error",new u.$({path:e.path,operation:"update",requestResourceData:t}))})}function p(e){(0,o.kd)(e).catch(t=>{n.d.emit("permission-error",new u.$({path:e.path,operation:"delete"}))})}var m=r(59253);function h(e){(0,m.zK)(e)}function f(e,t,r){(0,m.eJ)(e,t,r)}function v(e,t,r){(0,m.x9)(e,t,r)}},41048:(e,t,r)=>{r.d(t,{G:()=>n});var a=r(12115),i=r(19708),s=r(9891),o=r(86501);function n(e){let[t,r]=(0,a.useState)(null),[n,u]=(0,a.useState)(!1),[l,c]=(0,a.useState)(null);if((0,a.useEffect)(()=>{if(!e){r(null),u(!1),c(null);return}u(!0),c(null);let t=(0,i.aQ)(e,e=>{let t=[];for(let r of e.docs)t.push({...r.data(),id:r.id});r(t),c(null),u(!1)},t=>{let a="collection"===e.type?e.path:e._query.path.canonicalString(),i=new o.$({operation:"list",path:a});c(i),r(null),u(!1),s.d.emit("permission-error",i)});return()=>t()},[e]),e&&!e.__memo)throw Error(e+" was not properly memoized using useMemoFirebase");return{data:t,isLoading:n,error:l}}},86501:(e,t,r)=>{r.d(t,{$:()=>i});var a=r(59253);class i extends Error{constructor(e){let t=function(e){let t=null;try{let e=(0,a.xI)().currentUser;e&&(t=function(e){var t;if(!e)return null;let r={name:e.displayName,email:e.email,email_verified:e.emailVerified,phone_number:e.phoneNumber,sub:e.uid,firebase:{identities:e.providerData.reduce((e,t)=>(t.providerId&&(e[t.providerId]=[t.uid]),e),{}),sign_in_provider:(null==(t=e.providerData[0])?void 0:t.providerId)||"custom",tenant:e.tenantId}};return{uid:e.uid,token:r}}(e))}catch(e){}return{auth:t,method:e.operation,path:"/databases/(default)/documents/".concat(e.path),resource:e.requestResourceData?{data:e.requestResourceData}:void 0}}(e);super("Missing or insufficient permissions: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify(t,null,2))),this.name="FirebaseError",this.request=t}}},99470:(e,t,r)=>{r.d(t,{u:()=>n});var a=r(12115),i=r(19708),s=r(9891),o=r(86501);function n(e){let[t,r]=(0,a.useState)(null),[n,u]=(0,a.useState)(!1),[l,c]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e){r(null),u(!1),c(null);return}u(!0),c(null);let t=(0,i.aQ)(e,e=>{e.exists()?r({...e.data(),id:e.id}):r(null),c(null),u(!1)},t=>{let a=new o.$({operation:"get",path:e.path});c(a),r(null),u(!1),s.d.emit("permission-error",a)});return()=>t()},[e]),{data:t,isLoading:n,error:l}}}}]);